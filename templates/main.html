{% from "_formhelpers.html" import render_input_bool %}
{% from "_formhelpers.html" import render_input_text %}
{% from "_formhelpers.html" import render_input_number %}

{% extends "layout.html" %}
{% block body %}

  <h2>Crawlers</h2>
  <form action="{{ url_for('.new_crawler') }}" method="post">
    <button type="submit" name="from_main">Add new crawler</button>
  </form>
  <form action="/crawler-update" method="post">
    <table class="sortable">
      <tr>
        <th>Selected</th>
        <th>Name</th>
        <th>Active</th>
        <th>Run cadence</th>
        <th>Last run</th>
      </tr>

        {% for crawler in crawlers %}
          <tr>
            <td>{{render_input_bool(crawler.crawlerid, 'selected', False)}}</td>
            <td>{{render_input_text(crawler.crawlerid, 'name', crawler.name)}}</td>
            <td>{{render_input_bool(crawler.crawlerid, 'active', crawler.active)}}</td>
            <td>{{render_input_number(crawler.crawlerid, 'runcadence', crawler.runcadence)}}</td>
            <td>{{crawler.lastrun}}</td>
            <input type="text" name="{{ crawler.crawlerid }}_{{ dummy }}" value="dummy" hidden="true"/>
          </tr>
        {% endfor %}
    </table>
    <input type="submit" name="save_button" value="Save changes"/>
    <input type="submit" name="delete_button" value="Delete selected"/>
    <input type="submit" name="filter_button" value="Filter to selected"/>

  </form>

  <h2>Spiderbots</h2>
  <form action="{{ url_for('.new_spiderbot') }}" method="post">
    <button type="submit" name="from_main">Add new spiderbot</button>
  </form>
  <form action="/spiderbot-update" method="post">
    <table class="sortable">
      <tr>
        <th>Selected</th>
        <th>Crawler</th>
        <th>Spider</th>
        <th>Active</th>
        <th>Search Term</th>
        <th>Full Link</th>
      </tr>

        {% for spiderbot in spiderbots %}
          <tr>
            <td>{{render_input_bool(spiderbot.spiderbotid, 'selected', False)}}</td>
            <td>{{ spiderbot.crawler }}</td>
            <td>{{ spiderbot.spider }}</td>
            <td>{{render_input_bool(spiderbot.crawlerid, 'active', spiderbot.active)}}</td>
            <td>{{render_input_text(spiderbot.crawlerid, 'searchterm', spiderbot.searchterm)}}</td>
            <td>{{render_input_text(spiderbot.crawlerid, 'fullink', spiderbot.fullink)}}</td>

            <input type="text" name="{{ spiderbot.crawlerid }}_{{ dummy }}" value="dummy" hidden="true"/>
          </tr>
        {% endfor %}
    </table>
    <input type="submit" name="save_button" value="Save changes"/>
    <input type="submit" name="delete_button" value="Delete selected"/>
    <input type="submit" name="filter_button" value="Filter to selected"/>

  </form>



  <h2>Matches</h2>
  <form action="/match-update" method="post">
    <table class="sortable">
      <tr>
        <th>Hide</th>
        <th>Image</th>
        <th>Title</th>
        <th>Price</th>
        <th>Location</th>
        <th>Seller</th>
      </tr>

        {% for match in matches %}
          <tr>
            <td>{{render_input_bool(match.matchid, 'hide', match.hide)}}</td>
            <td><img src="/static{{match.image}}" loading="lazy" alt="..." width="150"></td>
            <td><a href="{{match.url}}">{{match.title}}</a></td>
            <td>{{match.price}}</td>
            <td>{{match.location}}</td>
            <td>{{match.seller}}</td>
            <input type="text" name="{{ match.matchid }}_{{ dummy }}" value="dummy" hidden="true"/>
          </tr>
        {% endfor %}
    </table>
    <button type="submit">Hide selected matches</button>
  </form>

{% endblock %}